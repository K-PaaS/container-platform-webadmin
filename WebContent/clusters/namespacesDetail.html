<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>PaaS-TA Container</title>
    <link href="../resources/css/layout.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div id="wrap">
		<!-- Header -->
		<header>
			<div>
				<!-- logo -->
				<h1>
					<a href="../index.html"><img src="../resources/img/logo.png" alt="PaaS-TA 로고" /></a>
				</h1>
				<!-- menu -->
				<div>
					<!-- title -->
					<h3>
						<a href="javascript:;" class="nameTop">ALL</a>
						<ul class="nameSpace scroll02">
						</ul>
					</h3>
					<!-- member-menu -->
					<div>
						<a href="javascript:;" id="logout">로그아웃</a>
						<div>
							<a href="javascript:;" id="userSetting">환경설정</a>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!-- // Header -->
		<!-- container -->
		<div id="container">
			<!-- aside -->
			<aside>
				<nav>
					<ul>
						<li class="plus">
							<a href="javascript:;" class="dep01">Clusters</a>
							<ul class="sub">
								<li><a href="namespaces.html">Namespaces</a></li>
								<li><a href="nodes.html">Nodes</a></li>
							</ul>
						</li>
						<li class="plus">
							<a href="javascript:;" class="dep01">Workloads</a>
							<ul class="sub">
								<li><a href="../workloads/deployments.html">Deployments</a></li>
								<li><a href="../workloads/pods.html">Pods</a></li>
								<li><a href="../workloads/replicaSets.html">Replica Sets</a></li>
							</ul>
						</li>
						<li>
							<a href="../services/services.html" class="dep01">Services</a>
						</li>
						<li class="plus">
							<a href="javascript:;" class="dep01">Storages</a>
							<ul class="sub">
								<li><a href="../storages/persistentVolumes.html">Persistsnt Volumes</a></li>
								<li><a href="../storages/persistentVolumeClaims.html">Persistsnt Volume Claims</a></li>
								<li><a href="../storages/storageClasses.html">Storage Classes</a></li>
							</ul>
						</li>
						<li class="plus">
							<a href="javascript:;" class="dep01">Managements</a>
							<ul class="sub">
								<li><a href="../managements/users.html">Users</a></li>
								<li><a href="../managements/roles.html">Roles</a></li>
								<li><a href="../managements/resourceQuotas.html">Resource Quotas</a></li>
								<li><a href="../managements/limitRanges.html">Limit Ranges</a></li>
							</ul>
						</li>
					</ul>
				</nav>
			</aside>
			<!-- // aside -->
			<!-- Content -->
			<div id="content" class="sub-page clusters">
				<article class="location">
					<ul>
						<li><a href="javascript:;">Overview</a></li>
						<li><a href="javascript:;">Clusters</a></li>
						<li>Namespaces</li>
					</ul>
				</article>
				<article class="base detail">
					<div class="notice">
						<h4>Details</h4>
						<div class="table_style01">
							<table>
								<colgroup >
									<col width="18%" />
									<col width="82%" />
								</colgroup>
								<tbody class="listTable">
									<tr>
										<th scope="row" class="left">Name</th>
										<td class="left" id="name"></td>
									</tr>
									<tr>
										<th scope="row" class="left">UID</th>
										<td class="left" id="uid"></td>
									</tr>
									<tr>
										<th scope="row" class="left">Labels</th>
										<td class="ellips left" id="labels">
											<div></div>
										</td>
									</tr>
									<tr>
										<th scope="row" class="left">Annotations</th>
										<td class="left" id="annot"></td>
									</tr>
									<tr>
										<th scope="row" class="left">Status</th>
										<td class="left" id="status"></td>
									</tr>
									<tr>
										<th scope="row" class="left">Created time</th>
										<td class="left" id="time"></td>
									</tr>
								</tbody>
							</table>
						</div>
						<h4>Resource Quotas</h4>
						<div class="table_style01">
							<table>
								<colgroup >
									<col width="20%" />
									<col width="60%" />
									<col width="20%" />
								</colgroup>
								<thead>
									<tr>
										<th scope="col">Name</th>
										<th scope="col">Status</th>
										<th scope="col">Created Time</th>
									</tr>
								</thead>
								<tbody class="resourceList">
								</tbody>
							</table>
						</div>
						<h4>Limit Ranges</h4>
						<div class="table_style01">
							<table>
								<colgroup >
									<col width="55%" />
									<col width="15%" />
									<col width="15%" />
									<col width="15%" />
								</colgroup>
								<thead>
									<tr>
										<th scope="col">Resource Name</th>
										<th scope="col">Resource Type</th>
										<th scope="col">Default Limit</th>
										<th scope="col">Default Request</th>
									</tr>
								</thead>
								<tbody class="limitList">
								</tbody>
							</table>
						</div>
						<h4>Events</h4>
						<div class="table_style01">
							<table>
								<colgroup >
									<col width="20%" />
									<col width="20%" />
									<col width="16%" />
									<col width="8%" />
									<col width="18%" />
									<col width="18%" />
								</colgroup>
								<thead>
									<tr>
										<th scope="col">Message</th>
										<th scope="col">Source</th>
										<th scope="col">Sub-object</th>
										<th scope="col">Count</th>
										<th scope="col">First seen</th>
										<th scope="col">Last seen</th>
									</tr>
								</thead>
								<tbody class="eventsList">
								</tbody>
							</table>
						</div>
						<h4>Users</h4>
						<div class="table_style01">
							<table>
								<caption>Users</caption>
								<colgroup >
									<col width="10%" />
									<col width="30%" />
									<col width="30%" />
									<col width="30%" />
								</colgroup>
								<thead>
									<tr>
										<th scope="col">Admin</th>
										<th scope="col">User ID</th>
										<th scope="col">Services Account</th>
										<th scope="col">Created time</th>
									</tr>
								</thead>
								<tbody class="usersList">
								</tbody>
							</table>
						</div>
					</div>
					<!-- btn -->
					<div class="btn02">
						<button type="submit" id="delete">삭제</button>
						<div>
							<a href="namespacesUpdate.html">수정</a>
							<a href="namespaces.html">이전</a>
						</div>
					</div>
				</article>
			</div>
			<!-- // Content -->
		</div>
		<!-- // container -->
		<!-- modal -->
		<div class="modal-wrap" style="display:none;">
			<div class="modal">
				<h5>삭제확인</h5>
				<p>리소스를 삭제하시겠습니까?</p>
				<button class="confirm" type="submit">삭제</button>
				<a class="close" href="javascript:;">닫기</a>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../resources/js/c3.min.js"></script>
	<script type="text/javascript" src="../resources/js/common.js"></script>
	<script type="text/javascript">
		window.onload = () => {

			func.init(0, 0);

			const nameDetail = {
				init(data){
					func.nameLoad = nameDetail.init;

					// nameSpace 정보 조회
					func.loadData('GET', `${func.url}clusters/${sessionStorage.getItem('cluster')}/namespaces/${sessionStorage.getItem('nameSpace')}`, 'application/json', nameDetail.draw);
					
					// resource 정보 조회
					func.loadData('GET', `${func.url}clusters/${sessionStorage.getItem('cluster')}/namespaces/${sessionStorage.getItem('nameSpace')}/popup/resourceQuotas/template?offset=0&limit=10`, 'application/json', nameDetail.resource);
					
					// limit 정보 조회
					func.loadData('GET', `${func.url}clusters/${sessionStorage.getItem('cluster')}/namespaces/${sessionStorage.getItem('nameSpace')}/popup/limitRanges/template?offset=0&limit=10`, 'application/json', nameDetail.limit);
					
					// events 정보 조회
					func.loadData('GET', `${func.url}clusters/${sessionStorage.getItem('cluster')}/namespaces/${sessionStorage.getItem('nameSpace')}/events`, 'application/json', nameDetail.events);
					
					// users 정보 조회
					func.loadData('GET', `${func.url}clusters/${sessionStorage.getItem('cluster')}/namespaces/${sessionStorage.getItem('nameSpace')}/users/namespace`, 'application/json', nameDetail.users);

					nameDetail.event();
				},

				draw(data){
					/*
					annotations: null
					creationTimestamp: "2020-11-17 15:48:24"
					detailMessage: "정상적으로 처리 되었습니다."
					httpStatusCode: 200
					labels: null
					name: "tttttttt"
					namespaceStatus: "Active"
					resultCode: "SUCCESS"
					resultMessage: "정상적으로 처리 되었습니다."
					uid: "b5805078-9e3a-4335-9936-e41addd91fa0"
					*/

					document.getElementById('name').innerText = data.name;
					document.getElementById('uid').innerText = data.uid;
					document.getElementById('labels').innerHTML = `<span>${JSON.stringify(data.labels)}</span><div class="scroll02">${JSON.stringify(data.labels)}</div>`;
					document.getElementById('status').innerText = data.namespaceStatus;
					document.getElementById('time').innerText = data.creationTimestamp;

					if(data.annotations.length > 0){
						for(i=0; i<=data.annotations.length-1; i++){
							if(data.annotations[i].checkYn == 'Y'){
								var html = `<dl class="fly">
												<dt>${data.annotations[i].key}</dt>
												<dd> ${data.annotations[i].value}</dd>
											</dl>`;
							} else if(data.annotations[i].checkYn == 'N'){
								var html = `<dl>
												<dt>${data.annotations[i].key}</dt>
												<dd> ${data.annotations[i].value}</dd>
											</dl>`;
							} else {
								var html = `<dl>
												<dt>-</dt>
											</dl>`;
							};

							func.appendHtml(document.getElementById('annot'), html, 'dl');
						};
					};
				},

				event(){
					document.getElementById('delete').addEventListener('click', (e) => {
						func.alertPopup('DELETE', '삭제하시겠습니까?', true, '확인', nameDetail.delete);
					}, false);
				},

				delete(){
					func.saveData('DELETE', `${func.url}clusters/${sessionStorage.getItem('cluster')}/namespaces/${sessionStorage.getItem('nameSpace')}`,'' , true, 'application/json', nameDetail.returnPage);
				},

				returnPage(){
					document.location.href = 'namespaces.html';
				},

				resource(data){
					/*
					detailMessage: "정상적으로 처리 되었습니다."
					httpStatusCode: 200
					itemMetaData:
						allItemCount: 3
						remainingItemCount: 0
					items: Array(3)
						0:
							checkYn: "Y"
							creationTimestamp: "2020-11-05 13:26:24"
							limitCpu: "2"
							limitMemory: "2Gi"
							name: "paas-ta-container-platform-low-rq"
							requestCpu: "0"
							requestMemory: "0"
							status: "{"hard":{"limits.cpu":"2","limits.memory":"2Gi"},"used":{"limits.cpu":"200m","limits.memory":"1800Mi"}}"
						1: {name: "paas-ta-container-platform-medium-rq", requestCpu: "0", requestMemory: "0", limitCpu: "4", limitMemory: "6Gi", …}
					metadata: null
					resultCode: "SUCCESS"
					resultMessage: "정상적으로 처리 되었습니다."
					*/

					for(var i=0; i<=data.items.length-1; i++){
						if(data.items[i].checkYn == 'Y'){
							var html = `<tr><td class="left">${data.items[i].name}</td><td class="left">${data.items[i].status}</td><td>${data.items[i].creationTimestamp}</td></tr>`;

							func.appendHtml(document.querySelector('.resourceList'), html, 'tbody');
						};
					};
				},

				limit(data){
					/*
					detailMessage: "정상적으로 처리 되었습니다."
					httpStatusCode: 200
					itemMetaData: null
					items: Array(8)
						0: {name: "paas-ta-container-platform-low-limit-range", type: "Container", resource: "cpu", min: "0", max: "0", …}
						1: {name: "paas-ta-container-platform-low-limit-range", type: "Container", resource: "memory", min: "0", max: "0", …}
					metadata: null
					resultCode: "SUCCESS"
					resultMessage: "정상적으로 처리 되었습니다."
					*/
					
					for(var i=0; i<=data.items.length-1; i++){
						if(data.items[i].checkYn == 'Y'){
							var html = `<tr>
											<td class="left">${data.items[i].name}</td>
											<td>${data.items[i].type}</td>
											<td>${data.items[i].defaultLimit}</td>
											<td>${data.items[i].defaultRequest}</td>
										</tr>`;

							func.appendHtml(document.querySelector('.limitList'), html, 'tbody');
						};
					}

				},

				events(data){
					/*
					detailMessage: "정상적으로 처리 되었습니다."
					httpStatusCode: 200
					items: Array(5)
						0:
						count: 1624
						filePath: "spec.containers{kjh-pod-20201112}"
						firstTimestamp: "2020-11-12T06:56:05Z"
						lastTimestamp: "2020-11-18T02:03:16Z"
						message: "Pulling image "slokang/hello-kubernetes:v3""
						source: {component: "kubelet", host: "paasta-cp-k8s-worker-003"}
						1: {message: "Back-off pulling image "slokang/hello-kubernetes:v3"", source: {…}, filePath: "spec.containers{kjh-pod-20201112}", count: 36751, firstTimestamp: "2020-11-12T06:56:07Z", …}
					resultCode: "SUCCESS"
					resultMessage: "정상적으로 처리 되었습니다."
					*/

					if(data.items.length > 0){
						for(var i=0; i<=data.items.length-1; i++){
							var html = `<tr><td class="left">${data.items[i].message}</td><td class="left">${JSON.stringify(data.items[i].source)}</td><td class="left">${data.items[i].filePath}</td><td>${data.items[i].count}</td><td>${data.items[i].firstTimestamp}</td><td>${data.items[i].lastTimestamp}</td></tr>`;

							func.appendHtml(document.querySelector('.eventsList'), html, 'tbody');
						};
					} else {
						var html = `<tr><td colspan="6">No Events.<td></tr>`;

						func.appendHtml(document.querySelector('.eventsList'), html, 'tbody');
					};
				},

				users(data){
					/*
					detailMessage: "정상적으로 처리 되었습니다."
					httpStatusCode: 200
					items: Array(1)
						0: {isAdmin: "Y", userId: "super", serviceAccountName: "super", created: "2020-11-17 15:47:25", userType: "NAMESPACE_ADMIN"}
					resultCode: "SUCCESS"
					resultMessage: "정상적으로 처리 되었습니다."
					*/

					for(var i=0; i<=data.items.length-1; i++){
						var html = `<td>${data.items[i].isAdmin}</td>
						<td><a href="javascript:;" data-name="${data.items[i].userId}">${data.items[i].userId}</a></td>
						<td>${data.items[i].serviceAccountName}</td>
						<td>${data.items[i].created}</td>`;

						func.appendHtml(document.querySelector('.usersList'), html, 'tbody');
					};

					nameDetail.userEvent();
				},

				userEvent(){
					var listAll = document.querySelector('.usersList').querySelectorAll('a');
					
					for(var i=0; i<=listAll.length-1; i++){
						listAll[i].addEventListener('click', (e) => {
							sessionStorage.setItem('commonName', e.target.getAttribute('data-name'));

							document.location.href = `${func.ui}managements/usersDetail.html`;
						}, true);
					};
				},
			}

			nameDetail.init();
		}
	</script>
</body>
</html>